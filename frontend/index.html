<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KosPrice v1.1</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input { width: 200px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .result { margin: 20px 0; padding: 15px; background: #e8f5e8; border-radius: 4px; }
    .error { background: #f8d7da; color: #721c24; }
    .history { margin-top: 30px; }
    .history-item { padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9; }
    .history-header { font-weight: bold; color: #555; }
    .refresh-btn { background: #28a745; margin-left: 10px; }
    .refresh-btn:hover { background: #1e7e34; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Prediksi Harga Kos v1.1</h1>
    
    <form id="predict-form">
      <div class="form-group">
        <label>Luas (m2):</label>
        <input type="number" id="luas" step="0.1" required>
      </div>

      <div class="form-group">
        <label>Jumlah Kamar:</label>
        <input type="number" id="kamar" required>
      </div>

      <div class="form-group">
        <label>Jarak Kampus (km):</label>
        <input type="number" id="jarak" step="0.1" required>
      </div>

      <button type="submit">Prediksi</button>
    </form>

    <div id="hasil"></div>

    <div class="history">
      <h2>Histori Prediksi 
        <button id="refresh-history" class="refresh-btn">Refresh</button>
      </h2>
      <div id="history-list">Loading histori...</div>
    </div>
  </div>

  <script>
    const form = document.getElementById("predict-form");
    const hasilDiv = document.getElementById("hasil");
    const historyList = document.getElementById("history-list");

    // Submit form prediksi
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        luas_m2: parseFloat(document.getElementById("luas").value),
        jumlah_kamar: parseInt(document.getElementById("kamar").value),
        jarak_kampus_km: parseFloat(document.getElementById("jarak").value)
      };

      try {
        const res = await fetch("http://127.0.0.1:8000/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        hasilDiv.className = "result";
        hasilDiv.innerHTML = `<strong>Prediksi harga: Rp ${result.prediksi_harga.toLocaleString()}</strong>`;
        
        // Refresh histori setelah prediksi
        loadHistory();
      } catch (err) {
        hasilDiv.className = "result error";
        hasilDiv.innerHTML = `<strong>Error:</strong> ${err}`;
      }
    });

    // Load histori
    async function loadHistory() {
      try {
        const res = await fetch("http://127.0.0.1:8000/history");
        const data = await res.json();
        
        if (data.history.length === 0) {
          historyList.innerHTML = "<p>Belum ada histori prediksi.</p>";
          return;
        }

        historyList.innerHTML = data.history.map(item => {
          const date = new Date(item.timestamp).toLocaleString();
          return `
            <div class="history-item">
              <div class="history-header">${date}</div>
              <div>Luas: ${item.input.luas_m2} mÂ² | Kamar: ${item.input.jumlah_kamar} | Jarak: ${item.input.jarak_kampus_km} km</div>
              <div><strong>Prediksi: Rp ${item.prediksi_harga.toLocaleString()}</strong></div>
            </div>
          `;
        }).join("");
      } catch (err) {
        historyList.innerHTML = `<p class="error">Error loading histori: ${err}</p>`;
      }
    }

    // Refresh button
    document.getElementById("refresh-history").addEventListener("click", loadHistory);

    // Load histori saat halaman dibuka
    loadHistory();
  </script>
</body>
</html>
